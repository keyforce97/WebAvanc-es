<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TEST SIMPLE - Cr√©er Commande</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    .form-group { margin: 1rem 0; }
    label { display: block; margin-bottom: 0.5rem; font-weight: bold; }
    input { padding: 0.5rem; width: 200px; }
    button { padding: 0.75rem 1.5rem; background: #27ae60; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #229954; }
    #result { margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>üß™ TEST SIMPLE - Cr√©er une Commande</h1>
  
  <form id="simpleOrderForm">
    <div class="form-group">
      <label for="productId">ID Produit:</label>
      <input type="number" id="productId" name="productId" min="1" value="1" required>
    </div>
    
    <div class="form-group">
      <label for="quantity">Quantit√©:</label>
      <input type="number" id="quantity" name="quantity" min="1" value="2" required>
    </div>
    
    <button type="submit">‚úÖ CR√âER COMMANDE</button>
  </form>
  
  <div id="result"></div>

  <script>
    console.log('üîß Script simple charg√©');
    
    document.getElementById('simpleOrderForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '‚è≥ Cr√©ation en cours...';
      
      console.log('üöÄ D√âBUT - Cr√©ation commande simple');
      
      try {
        // R√©cup√©rer les donn√©es
        const productId = parseInt(document.getElementById('productId').value);
        const quantity = parseInt(document.getElementById('quantity').value);
        
        console.log('üìù Donn√©es:', { productId, quantity });
        
        // Cr√©er le payload
        const payload = {
          products: [
            {
              id: productId,
              quantity: quantity
            }
          ]
        };
        
        console.log('üöÄ Payload:', JSON.stringify(payload));
        
        // Appel API
        const response = await fetch('http://localhost:5002/order', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });
        
        console.log('üì° R√©ponse:', response.status, response.statusText);
        console.log('üì° URL finale:', response.url);
        
        if (response.ok || response.redirected) {
          // Succ√®s !
          const orderIdMatch = response.url.match(/\/order\/(\d+)/);
          const orderId = orderIdMatch ? orderIdMatch[1] : 'Inconnue';
          
          resultDiv.innerHTML = `
            <h3>‚úÖ SUCC√àS !</h3>
            <p><strong>Commande cr√©√©e avec l'ID: ${orderId}</strong></p>
            <p>Statut: ${response.status}</p>
            <p>URL: ${response.url}</p>
          `;
          
          console.log('‚úÖ SUCC√àS - Commande cr√©√©e avec ID:', orderId);
          
        } else {
          // Erreur
          const text = await response.text();
          resultDiv.innerHTML = `
            <h3>‚ùå ERREUR</h3>
            <p>Statut: ${response.status}</p>
            <p>Message: ${text}</p>
          `;
          
          console.error('‚ùå ERREUR:', response.status, text);
        }
        
      } catch (error) {
        console.error('üí• EXCEPTION:', error);
        resultDiv.innerHTML = `
          <h3>üí• EXCEPTION</h3>
          <p>${error.message}</p>
        `;
      }
    });
    
    console.log('‚úÖ Gestionnaire d\'√©v√©nement attach√©');
  </script>
</body>
</html>
